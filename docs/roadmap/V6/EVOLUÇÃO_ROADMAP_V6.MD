# Roadmap v6.0 ‚Äî Evolu√ß√£o Estrat√©gica do Maestro MCP

> **Data:** 2026-02-07  
> **Vers√£o alvo:** 6.0.0  
> **Refer√™ncias:** Auditoria v5.1, Roadmap v5.2, Diagn√≥stico MCP, spec MCP 2025-11-25  
> **Pr√©-requisito:** Conclus√£o da v5.2

---

## 1. Resumo Executivo

### Linha do Tempo

```
v1.0 ‚îÄ‚îÄ‚îÄ 44 tools, sem organiza√ß√£o
v3.0 ‚îÄ‚îÄ‚îÄ Router centralizado
v4.0 ‚îÄ‚îÄ‚îÄ 8 tools p√∫blicas, middleware pipeline
v5.0 ‚îÄ‚îÄ‚îÄ Onboarding v2, flow engine, prompts MCP
v5.1 ‚îÄ‚îÄ‚îÄ Infraestrutura de adapta√ß√£o (12 m√≥dulos, 7 √≥rf√£os)
v5.2 ‚îÄ‚îÄ‚îÄ [EM ANDAMENTO] Wiring, cleanup, testes
v6.0 ‚îÄ‚îÄ‚îÄ [ESTE DOCUMENTO] Salto arquitetural completo
```

A v6 transforma o Maestro de "toolkit com router" em **plataforma de orquestra√ß√£o** compliant com MCP 2025-11-25.

### Pilares

| Pilar | Descri√ß√£o |
|-------|-----------|
| **Protocol-first** | Compliance total com MCP 2025-11-25 (Tasks, Elicitation, Sampling with Tools) |
| **Breaking clean** | Remo√ß√£o de 37 tools legadas, ToolResult strict, zero backward compat v4 |
| **Platform mindset** | MCP Apps, Registry, extens√µes oficiais |
| **Intelligence** | Adapta√ß√£o por client, sampling delegada, an√°lise com LLM separada |
| **DX excellence** | 5 tools, onboarding em 2 intera√ß√µes, zero-config |

---

## 2. Gap Analysis: Maestro v5.x vs MCP 2025-11-25

| Feature MCP | Spec 2025-11-25 | Maestro v5.x | Gap |
|-------------|-----------------|--------------|-----|
| **Tasks** (async) | ‚úÖ Experimental | ‚ùå | üî¥ Cr√≠tico |
| **Elicitation URL mode** | ‚úÖ Est√°vel | ‚ùå Fallback MD | üü° M√©dio |
| **Sampling with Tools** | ‚úÖ tools+toolChoice | ‚ùå | üî¥ Cr√≠tico |
| **Icons** tools/resources | ‚úÖ SEP-973 | ‚ùå | üü¢ Baixo |
| **outputSchema** | ‚úÖ Est√°vel | ‚ö†Ô∏è √ìrf√£o | üü° M√©dio |
| **structuredContent** | ‚úÖ Est√°vel | ‚ö†Ô∏è √ìrf√£o | üü° M√©dio |
| **Annotations** | ‚úÖ Est√°vel | ‚ö†Ô∏è √ìrf√£o | üü° M√©dio |
| **resource_link** | ‚úÖ Est√°vel | ‚ùå | üü° M√©dio |
| **MCP Apps** (HTML) | ‚úÖ Extension | ‚ùå | üü° M√©dio |
| **MCP Registry** | ‚úÖ Preview‚ÜíGA | ‚ùå | üü° M√©dio |
| **Streamable HTTP** | ‚úÖ Est√°vel | ‚ö†Ô∏è Express manual | üü° M√©dio |
| **Tool name format** | ‚úÖ SEP-986 | ‚ö†Ô∏è Nomes pt-BR | üü° M√©dio |
| **Input valid‚ÜíTool Error** | ‚úÖ SEP-1303 | ‚ùå Protocol error | üü° M√©dio |
| **Protocol version** | 2025-11-25 | 2025-03-26 | üü° 2 vers√µes atr√°s |

### Problemas Estruturais Herdados

| Problema | Severidade |
|----------|-----------|
| 37 tools legadas no allToolsMap | üî¥ Alta |
| ToolResult com `[x: string]: unknown` | üî¥ Alta |
| Duplica√ß√£o stdio.ts ‚Üî index.ts | üî¥ Alta |
| 7 m√≥dulos √≥rf√£os | üü° M√©dia |
| Zero testes unit√°rios | üî¥ Alta |
| Capability detection falha em STDIO | üî¥ Alta |
| tools/index.ts (411 linhas) morto | üü° M√©dia |
| 19 diret√≥rios, muitos com c√≥digo legado | üü° M√©dia |

### Roadmap Oficial MCP (pr√≥ximo release)

1. **Asynchronous Operations** ‚Äî Tasks como primitiva de primeira classe
2. **Statelessness and Scalability** ‚Äî Servidores horizontalmente escal√°veis
3. **Server Identity** ‚Äî `.well-known` URLs para discovery
4. **Official Extensions** ‚Äî Padr√µes para dom√≠nios espec√≠ficos
5. **SDK Standardization** ‚Äî Tiering de SDKs
6. **MCP Registry GA** ‚Äî Cat√°logo p√∫blico de servidores

---

## 3. Vis√£o v6: De Orquestrador para Plataforma

### Mudan√ßa de Paradigma

```
v5.x: IA decide ‚Üí chama tool ‚Üí Maestro retorna texto ‚Üí IA interpreta ‚Üí IA decide

v6.0: Usu√°rio fala ‚Üí IA chama maestro ‚Üí Maestro retorna contrato tipado
      + next_action + task async + UI interativa ‚Üí IA executa contrato
```

### Princ√≠pios Arquiteturais

1. **Protocol-first** ‚Äî Usar primitivas MCP nativas antes de solu√ß√µes custom
2. **Zero legacy** ‚Äî Nenhuma tool legada aceita
3. **Typed contracts** ‚Äî outputSchema + structuredContent em todas as tools
4. **Adaptive by default** ‚Äî Comportamento muda por client automaticamente
5. **Async-ready** ‚Äî Opera√ß√µes longas usam Tasks com polling
6. **Content-rich** ‚Äî Annotations, resource_links, icons em todos os retornos
7. **Testable** ‚Äî 90%+ cobertura; testes de conformidade MCP

### Arquitetura-Alvo v6

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  Maestro MCP v6.0                        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Unified Transport Layer                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                     ‚îÇ
‚îÇ  ‚îÇ  STDIO   ‚îÇ  ‚îÇ  Streamable HTTP ‚îÇ                     ‚îÇ
‚îÇ  ‚îÇ  (IDEs)  ‚îÇ  ‚îÇ  (Web/Remote)    ‚îÇ                     ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                     ‚îÇ
‚îÇ       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                                ‚îÇ
‚îÇ                ‚Üì                                         ‚îÇ
‚îÇ  Capability-Aware Handler Layer                          ‚îÇ
‚îÇ  (detecta client, adapta output)                         ‚îÇ
‚îÇ                ‚Üì                                         ‚îÇ
‚îÇ  Tool Router (5 tools)                                   ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îÇ
‚îÇ  ‚îÇmaestro ‚îÇ‚îÇexecutar‚îÇ‚îÇvalidar‚îÇ‚îÇanalisar‚îÇ‚îÇctx   ‚îÇ       ‚îÇ
‚îÇ  ‚îÇ(entry) ‚îÇ‚îÇ(a√ß√µes) ‚îÇ‚îÇ(gates)‚îÇ‚îÇ(c√≥digo)‚îÇ‚îÇ(kb)  ‚îÇ       ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îÇ
‚îÇ                ‚Üì                                         ‚îÇ
‚îÇ  Middleware Pipeline v2                                  ‚îÇ
‚îÇ  error ‚Üí caps ‚Üí state ‚Üí flow ‚Üí persist ‚Üí skill          ‚îÇ
‚îÇ                ‚Üì                                         ‚îÇ
‚îÇ  Response Builder v2                                     ‚îÇ
‚îÇ  Markdown + structuredContent + Annotations              ‚îÇ
‚îÇ  + resource_links + outputSchema + Icons                 ‚îÇ
‚îÇ                ‚Üì                                         ‚îÇ
‚îÇ  Services Layer                                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                   ‚îÇ
‚îÇ  ‚îÇState     ‚îÇ‚îÇFlow      ‚îÇ‚îÇSkill     ‚îÇ                   ‚îÇ
‚îÇ  ‚îÇMachine   ‚îÇ‚îÇEngine    ‚îÇ‚îÇLoader    ‚îÇ                   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                   ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                   ‚îÇ
‚îÇ  ‚îÇTask      ‚îÇ‚îÇElicita-  ‚îÇ‚îÇSampling  ‚îÇ                   ‚îÇ
‚îÇ  ‚îÇManager   ‚îÇ‚îÇtion Svc  ‚îÇ‚îÇDelegator ‚îÇ                   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                   ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                   ‚îÇ
‚îÇ  ‚îÇClient    ‚îÇ‚îÇSystem    ‚îÇ‚îÇAnalytics ‚îÇ                   ‚îÇ
‚îÇ  ‚îÇCaps      ‚îÇ‚îÇPrompt    ‚îÇ‚îÇTelemetry ‚îÇ                   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                   ‚îÇ
‚îÇ                ‚Üì                                         ‚îÇ
‚îÇ  Persistence  ‚îÇ Content Library ‚îÇ MCP Apps (HTML)        ‚îÇ
‚îÇ  .maestro/    ‚îÇ 374 skills      ‚îÇ Dashboard, Forms       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## 4. Eixo 1 ‚Äî Breaking Changes e Limpeza Estrutural

> **Objetivo:** Eliminar toda a d√≠vida t√©cnica acumulada desde v1.0  
> **Impacto:** üî¥ Breaking ‚Äî Incompat√≠vel com v5.x

### 4.1. Remo√ß√£o de Tools Legadas

**Estado atual:** 8 p√∫blicas + 37 legadas = 45 tools aceitas pelo router.

**A√ß√£o v6:** Remover completamente `legacyTools` do `router.ts`. Chamadas a tools removidas retornam erro claro com migration guide.

**37 tools removidas:**
```
setup_inicial, iniciar_projeto, confirmar_projeto, confirmar_stitch,
carregar_projeto, proximo, validar_gate, aprovar_gate, classificar,
confirmar_classificacao, implementar_historia, nova_feature, corrigir_bug,
refatorar, analisar_seguranca, analisar_qualidade, analisar_performance,
gerar_relatorio, atualizar_codebase, avaliar_entregavel, injetar_conteudo,
discovery, onboarding_orchestrator, brainstorm, prd_writer,
next_steps_dashboard, record_adr, record_pattern, get_context,
search_knowledge, create_checkpoint, rollback_total, rollback_partial,
list_checkpoints, validate_dependencies, validate_security, check_compliance,
evaluate_risk, auto_fix, discover_codebase
```

**Impacto:** ~300 linhas removidas do router.ts, ~20 arquivos de tools remov√≠veis.

### 4.2. ToolResult Strict

**Estado atual (permissivo):**
```typescript
export interface ToolResult {
    [x: string]: unknown;  // ‚Üê Permite QUALQUER campo
    content: Array<{ type: "text"; text: string }>;
    isError?: boolean;
    files?: Array<{ path: string; content: string }>;
    estado_atualizado?: string;
    next_action?: NextAction;
    specialist_persona?: SpecialistPersona;
    progress?: FlowProgress;
}
```

**v6 (strict, MCP-compliant):**
```typescript
export interface ToolResult {
    content: Array<ContentBlock>;
    structuredContent?: Record<string, unknown>;
    isError?: boolean;
}

type ContentBlock =
    | { type: "text"; text: string; annotations?: Annotations }
    | { type: "image"; data: string; mimeType: string; annotations?: Annotations }
    | { type: "resource_link"; uri: string; name: string; 
        description?: string; mimeType?: string; annotations?: Annotations }
    | { type: "resource"; resource: EmbeddedResource };

interface Annotations {
    audience?: ("user" | "assistant")[];
    priority?: number;  // 0.0 a 1.0
    lastModified?: string;
}
```

**Onde v√£o os metadados removidos:**
- `next_action` ‚Üí se√ß√£o Markdown no content + campo em structuredContent
- `specialist_persona` ‚Üí bloco com `annotations: { audience: ["assistant"] }`
- `progress` ‚Üí content + structuredContent
- `files` ‚Üí servidor grava diretamente (persist√™ncia ativa)
- `estado_atualizado` ‚Üí servidor grava diretamente

### 4.3. Consolida√ß√£o de Tools: 8 ‚Üí 5

| Tool v6 | Descri√ß√£o | Subsume de v5 |
|---------|-----------|---------------|
| `maestro` | Entry point. Sem a√ß√£o = status. Detecta contexto. | `maestro` + `status` |
| `executar` | A√ß√µes: avancar, salvar, checkpoint, rollback. | `avancar` + `salvar` + `checkpoint` |
| `validar` | Gate, entreg√°vel, compliance. | (mant√©m) |
| `analisar` | Seguran√ßa, qualidade, performance. Tasks para an√°lises longas. | (mant√©m) |
| `contexto` | Knowledge base: ADRs, padr√µes, busca. | (mant√©m) |

**Internacionaliza√ß√£o (SEP-986):**

| Atual (pt-BR) | Alias (en) | Decis√£o |
|----------------|------------|---------|
| `maestro` | `maestro` | Nome pr√≥prio, universal |
| `executar` | `execute` | Aceitar alias |
| `validar` | `validate` | Aceitar alias |
| `analisar` | `analyze` | Aceitar alias |
| `contexto` | `context` | Aceitar alias |

> **Recomenda√ß√£o:** Manter pt-BR como identidade, aceitar aliases em ingl√™s via router.

### 4.4. Remo√ß√£o de C√≥digo Morto

| Arquivo/Diret√≥rio | A√ß√£o |
|-------------------|------|
| `src/src/tools/index.ts` (411 linhas) | Remover ‚Äî substitu√≠do por router.ts |
| `src/src/frontend-first/` | Avaliar ‚Äî mover para plugin ou remover |
| `src/src/optimization/` | Avaliar ‚Äî mover para plugin ou remover |
| `src/src/tasks/` | Renomear ‚Äî conflita com MCP Tasks |
| Imports n√£o utilizados | Limpar em todos os arquivos |

### 4.5. Reestrutura√ß√£o de Diret√≥rios

**Proposta v6:**
```
src/
‚îú‚îÄ‚îÄ transports/     # stdio.ts, streamable-http.ts
‚îú‚îÄ‚îÄ router/         # router.ts, tool-definitions.ts
‚îú‚îÄ‚îÄ tools/          # 5 tools (maestro, executar, validar, analisar, contexto)
‚îú‚îÄ‚îÄ middleware/      # pipeline v2
‚îú‚îÄ‚îÄ services/       # state, flow, skill, cache, caps, task, elicitation, sampling
‚îú‚îÄ‚îÄ handlers/       # shared (resources, prompts, tools)
‚îú‚îÄ‚îÄ content/        # skill loader, content resolver, resource builder
‚îú‚îÄ‚îÄ types/          # interfaces MCP-compliant
‚îú‚îÄ‚îÄ utils/          # response-formatter, config, files
‚îú‚îÄ‚îÄ apps/           # MCP Apps (HTML dashboards)
‚îî‚îÄ‚îÄ tests/          # unit√°rios e integra√ß√£o
```

---

## 5. Eixo 2 ‚Äî Protocol Compliance (2025-11-25)

> **Objetivo:** Alinhar 100% com a spec MCP mais recente

### 5.1. Atualizar Protocol Version

- Atualizar `SUPPORTED_PROTOCOL_VERSION` para `"2025-11-25"`
- Atualizar SDK `@modelcontextprotocol/sdk` para vers√£o compat√≠vel
- Testar handshake com Windsurf, Cursor, VS Code, Claude Code

**Mudan√ßas no protocol 2025-11-25 vs 2025-03-26:**
- Tasks (experimental) ‚Äî SEP-1686
- Elicitation URL mode + defaults ‚Äî SEP-1036, SEP-1034
- Sampling with Tools ‚Äî SEP-1577
- Icons em tools/resources/prompts ‚Äî SEP-973
- Tool name format ‚Äî SEP-986
- Input validation ‚Üí Tool Error ‚Äî SEP-1303
- JSON Schema 2020-12 ‚Äî SEP-1613
- SSE polling via server disconnect ‚Äî SEP-1699

### 5.2. MCP Tasks ‚Äî Opera√ß√µes Ass√≠ncronas

**Problema:** An√°lises de c√≥digo e valida√ß√µes complexas bloqueiam a resposta.

**Solu√ß√£o:**
```typescript
async function analisar(args: AnalisarArgs): Promise<ToolResult> {
    if (estimateComplexity(args) > THRESHOLD) {
        const taskId = generateTaskId();
        taskManager.startTask(taskId, async () => {
            return await runFullAnalysis(args);
        });
        return {
            content: [{
                type: "text",
                text: "An√°lise iniciada. Acompanhe via task.",
                annotations: { audience: ["user"], priority: 1.0 }
            }],
        };
    }
    return runQuickAnalysis(args);  // S√≠ncronas continuam normais
}
```

**Tasks a implementar:**
- `analisar(tipo: "completo")` ‚Äî an√°lise full
- `validar(tipo: "compliance")` ‚Äî valida√ß√£o completa
- Qualquer opera√ß√£o > 10 segundos

### 5.3. Elicitation Nativa ‚Äî Discovery Interativo

**Problema:** Discovery coleta dados via texto livre. IA interpreta mal.

**Solu√ß√£o (form mode):**
```typescript
async function coletarDadosDiscovery(): Promise<ElicitationRequest> {
    return {
        method: "elicitation/create",
        params: {
            message: "Configura√ß√£o do projeto",
            requestedSchema: {
                type: "object",
                properties: {
                    nome: { type: "string", title: "Nome do projeto", default: "" },
                    problema: { type: "string", title: "Problema que resolve" },
                    complexidade: { 
                        type: "string", 
                        enum: ["simples", "medio", "complexo"],
                        default: "medio"
                    },
                    tipo: { 
                        type: "string", 
                        enum: ["poc", "script", "internal", "product"],
                        default: "internal"
                    },
                },
                required: ["nome", "problema"]
            }
        }
    };
}
```

**Fallback (clients sem Elicitation):** Markdown estruturado com op√ß√µes claras + perguntas em blocos (m√°x 2 intera√ß√µes).

### 5.4. Sampling with Tools ‚Äî An√°lise com LLM Dedicada

**Problema:** An√°lise de c√≥digo consome tokens do contexto principal, qualidade inconsistente.

**Solu√ß√£o:**
```typescript
async function analisarComSampling(codigo: string, tipo: string) {
    return {
        method: "sampling/createMessage",
        params: {
            messages: [{
                role: "user",
                content: { type: "text", text: `Analise: ${tipo}` }
            }, {
                role: "user",
                content: { type: "text", text: `\`\`\`\n${codigo}\n\`\`\`` }
            }],
            tools: [{
                name: "report_analysis",
                inputSchema: {
                    type: "object",
                    properties: {
                        score: { type: "number", minimum: 0, maximum: 100 },
                        issues: { type: "array", items: { type: "object" } }
                    },
                    required: ["score", "issues"]
                }
            }],
            toolChoice: { type: "tool", name: "report_analysis" },
            maxTokens: 2000,
            modelPreferences: {
                hints: [{ name: "claude-sonnet" }],
                intelligencePriority: 0.9
            }
        }
    };
}
```

**Benef√≠cio:** An√°lise em contexto limpo. LLM usa tools durante sampling para retornar dados estruturados.

### 5.5. Annotations em Todos os Retornos

| Tipo de conte√∫do | Annotations |
|-------------------|------------|
| Resumo para usu√°rio | `{ audience: ["user"], priority: 1.0 }` |
| Instru√ß√µes para IA | `{ audience: ["assistant"], priority: 0.9 }` |
| Templates/checklists | `{ audience: ["assistant"], priority: 0.7 }` |
| Metadados de progresso | `{ audience: ["user", "assistant"], priority: 0.5 }` |

### 5.6. Streamable HTTP (substituir Express manual)

Migrar `index.ts` para transport oficial do SDK:

```typescript
import { StreamableHTTPServerTransport } from 
    "@modelcontextprotocol/sdk/server/streamableHttp.js";

const transport = new StreamableHTTPServerTransport({
    sessionIdGenerator: () => crypto.randomUUID(),
});
await server.connect(transport);
```

**Benef√≠cios:** Resumability, session management, polling SSE, elimina ~200 linhas manuais.

### 5.7. Input Validation como Tool Error (SEP-1303)

```typescript
// ANTES (protocol error ‚Äî LLM n√£o se corrige)
throw new Error("Par√¢metro 'diretorio' obrigat√≥rio");

// DEPOIS (tool error ‚Äî LLM pode tentar novamente)
return {
    content: [{ type: "text", text: "Erro: 'diretorio' obrigat√≥rio" }],
    isError: true,
};
```

---

## 6. Eixo 3 ‚Äî Arquitetura de Nova Gera√ß√£o

### 6.1. State Machine Formal

**Problema:** Flow engine usa transi√ß√µes como objetos JS simples. Sem visualiza√ß√£o, sem valida√ß√£o formal, estado pode ficar inconsistente.

**Proposta:** State machine formal (XState ou implementa√ß√£o leve):

```typescript
const onboardingMachine = createMachine({
    id: "onboarding",
    initial: "init",
    context: { projectName: "", mode: "balanced" },
    states: {
        init: {
            on: {
                HAS_CONFIG: "discovery_block_1",
                NO_CONFIG: "setup",
            }
        },
        setup: { on: { SETUP_COMPLETE: "discovery_block_1" } },
        discovery_block_1: {
            on: { 
                BLOCK_ANSWERED: "discovery_block_2",
                WANTS_BRAINSTORM: "brainstorm",
            }
        },
        discovery_block_2: { on: { BLOCK_ANSWERED: "prd_generation" } },
        brainstorm: { on: { COMPLETE: "prd_generation", SKIP: "prd_generation" } },
        prd_generation: { on: { PRD_READY: "prd_validation" } },
        prd_validation: {
            on: { SCORE_OK: "phase_1", SCORE_LOW: "prd_refinement" }
        },
        prd_refinement: { on: { REFINED: "prd_validation" } },
        phase_1: { /* fases de desenvolvimento */ },
        completed: { type: "final" }
    }
});
```

**Benef√≠cios:**
- Transi√ß√µes validadas em compile-time
- Visualiza√ß√£o autom√°tica (XState Visualizer)
- Imposs√≠vel chegar em estado inv√°lido
- Serializa√ß√£o nativa para persist√™ncia
- Eventos tipados (TypeScript)

### 6.2. Persist√™ncia Ativa

**Problema:** Maestro retorna `files[]` e `estado_atualizado` esperando que a IA salve. Se a IA n√£o salvar, estado se perde.

**A√ß√£o v6:** Servidor grava diretamente no filesystem:

```typescript
class ActivePersistenceService {
    constructor(private projectDir: string) {}
    
    async saveState(state: ProjectState): Promise<void> {
        const dir = join(this.projectDir, ".maestro");
        await mkdir(dir, { recursive: true });
        await writeFile(join(dir, "estado.json"), JSON.stringify(state, null, 2));
    }
    
    async saveDeliverable(phase: number, content: string, filename: string): Promise<string> {
        const dir = join(this.projectDir, ".maestro", "deliverables", `phase-${phase}`);
        await mkdir(dir, { recursive: true });
        const path = join(dir, filename);
        await writeFile(path, content);
        return path;
    }
    
    async createCheckpoint(description: string): Promise<string> {
        const id = `cp-${Date.now()}`;
        const state = await this.loadState();
        const cpDir = join(this.projectDir, ".maestro", "checkpoints", id);
        await mkdir(cpDir, { recursive: true });
        await writeFile(join(cpDir, "estado.json"), JSON.stringify(state));
        await writeFile(join(cpDir, "meta.json"), JSON.stringify({ id, description }));
        return id;
    }
}
```

**Impacto:** Elimina a classe inteira de bugs "estado perdido porque a IA n√£o salvou".

### 6.3. Plugin Architecture para Analyzers

**Problema:** Analyzers hardcoded. Adicionar novo tipo requer modificar core.

```typescript
interface AnalyzerPlugin {
    name: string;
    description: string;
    supportedLanguages: string[];
    analyze(code: string, options: AnalyzerOptions): Promise<AnalysisResult>;
    getChecklist(): ChecklistItem[];
}

class AnalyzerRegistry {
    private plugins = new Map<string, AnalyzerPlugin>();
    register(plugin: AnalyzerPlugin): void { this.plugins.set(plugin.name, plugin); }
    async analyze(type: string, code: string, opts: AnalyzerOptions): Promise<AnalysisResult> {
        const plugin = this.plugins.get(type);
        if (!plugin) throw new Error(`Analyzer '${type}' not found`);
        return plugin.analyze(code, opts);
    }
}
```

**Plugins built-in:** security, quality, performance, accessibility, i18n  
**Plugins futuros:** OWASP, LGPD compliance, WCAG, custom rules

### 6.4. Event System para Extensibilidade

```typescript
class MaestroEventBus {
    private listeners = new Map<string, Set<EventHandler>>();
    on(event: MaestroEvent, handler: EventHandler): void { /* ... */ }
    emit(event: MaestroEvent, data: unknown): void { /* ... */ }
}

type MaestroEvent = 
    | "project:created" | "phase:advanced" | "phase:completed"
    | "gate:passed" | "gate:failed" | "checkpoint:created"
    | "analysis:started" | "analysis:completed" | "deliverable:saved";
```

---

## 7. Eixo 4 ‚Äî Experi√™ncia do Desenvolvedor (DX)

### 7.1. Onboarding em 2 Intera√ß√µes

**Fluxo atual:** 5-10+ intera√ß√µes para configurar projeto.

**Fluxo v6:**
```
Intera√ß√£o 1: Usu√°rio descreve projeto em texto livre
  ‚Üí Maestro extrai dados (NLP ou Elicitation form)
  ‚Üí Retorna resumo para confirma√ß√£o

Intera√ß√£o 2: Usu√°rio confirma/ajusta
  ‚Üí Maestro cria projeto com discovery preenchido
  ‚Üí Retorna primeiro passo de desenvolvimento
```

**Implementa√ß√£o:**
- **Smart extraction:** Extrair problema, p√∫blico, plataforma de texto livre
- **Template matching:** Descri√ß√£o match com template ‚Üí pr√©-preencher 80%
- **Confidence scoring:** Pedir confirma√ß√£o apenas para baixa confian√ßa

### 7.2. Project Templates

```typescript
const PROJECT_TEMPLATES = {
    "saas-b2b": {
        complexity: "complexo", type: "product",
        defaults: { platforms: ["web"], compliance: ["LGPD"] },
        phases: 12,
    },
    "api-rest": {
        complexity: "medio", type: "internal",
        defaults: { platforms: ["api"] },
        phases: 8,
    },
    "landing-page": {
        complexity: "simples", type: "poc",
        defaults: { platforms: ["web"] },
        phases: 5,
    },
    "mobile-app": { /* ... */ },
    "cli-tool": { /* ... */ },
    "chrome-extension": { /* ... */ },
};
```

### 7.3. MCP Apps ‚Äî Dashboard Visual

MCP Apps permitem retornar HTML interativo que renderiza no chat da IDE.

**Aplica√ß√µes no Maestro:**
1. **Dashboard de Progresso** ‚Äî Gr√°fico de fases, progresso %, timeline
2. **Formul√°rio de Discovery** ‚Äî Formul√°rio HTML interativo
3. **Relat√≥rio de An√°lise** ‚Äî Gr√°ficos de score, heatmap de issues
4. **Kanban de Entreg√°veis** ‚Äî Board visual com status por fase

```typescript
server.setRequestHandler(ReadResourceRequestSchema, async (req) => {
    if (req.params.uri === "maestro://apps/dashboard") {
        const state = await loadState(projectDir);
        return {
            contents: [{
                uri: req.params.uri,
                mimeType: "text/html",
                text: generateDashboardHTML(state),
            }]
        };
    }
});
```

> **Nota:** MCP Apps tem suporte limitado em IDEs. Implementar como feature opt-in.

### 7.4. Zero-Config para Projetos Simples

```
Usu√°rio: "crie um script Python para converter CSV para JSON"
  ‚Üí Maestro detecta: tipo=script, complexidade=simples
  ‚Üí Pula discovery, brainstorm, PRD
  ‚Üí Vai direto para implementa√ß√£o
  ‚Üí Retorna template + checklist m√≠nimo
```

### 7.5. Multi-Project Support

```typescript
// ~/.maestro/workspace.json
interface MaestroWorkspace {
    projects: Array<{
        name: string;
        directory: string;
        lastAccessed: string;
        phase: number;
        totalPhases: number;
    }>;
    activeProject?: string;
}
```

Detec√ß√£o autom√°tica do projeto pelo diret√≥rio atual (via Roots quando dispon√≠vel).

---

## 8. Eixo 5 ‚Äî Intelig√™ncia e Adapta√ß√£o Avan√ßada

### 8.1. Client Capability Detection v2

**Problema v5.x:** Detection funciona apenas em HTTP, n√£o em STDIO.

**Solu√ß√£o multi-camada:**

```typescript
class ClientCapabilitiesV2 {
    // Camada 1: Params do initialize (HTTP)
    captureFromInitialize(params: InitializeParams): void { /* ... */ }
    
    // Camada 2: Server SDK events (STDIO com SDK recente)
    captureFromServerEvents(server: Server): void {
        const clientCaps = server.getClientCapabilities?.();
        if (clientCaps) this.caps = this.parseCapabilities(clientCaps);
    }
    
    // Camada 3: Environment detection (fallback)
    captureFromEnvironment(): void {
        this.caps.clientName = this.detectClientFromEnv(process.env);
        Object.assign(this.caps, this.getKnownCapabilities(this.caps.clientName));
    }
    
    // Camada 4: Static knowledge base (√∫ltimo recurso)
    private getKnownCapabilities(client: string): Partial<ClientCapabilities> {
        const KNOWN = {
            "windsurf": { hasElicitation: false, hasSampling: false, hasTasks: false },
            "cursor":   { hasElicitation: true,  hasSampling: false, hasTasks: false },
            "vscode":   { hasElicitation: true,  hasSampling: true,  hasTasks: true  },
            "claude-code": { hasElicitation: false, hasSampling: false, hasTasks: false },
        };
        return KNOWN[client] || {};
    }
}
```

### 8.2. Adaptive Response Builder

Respostas que se adaptam automaticamente ao client:

```typescript
class AdaptiveResponseBuilder {
    constructor(private caps: ClientCapabilities) {}
    
    build(opts: ResponseOptions): ToolResult {
        const content: ContentBlock[] = [];
        
        // Resumo para usu√°rio
        content.push({
            type: "text",
            text: this.buildSummary(opts),
            ...(this.caps.hasAnnotations && {
                annotations: { audience: ["user"], priority: 1.0 }
            }),
        });
        
        // Instru√ß√µes para IA
        if (opts.instructions) {
            content.push({
                type: "text",
                text: this.buildInstructions(opts),
                ...(this.caps.hasAnnotations && {
                    annotations: { audience: ["assistant"], priority: 0.9 }
                }),
            });
        }
        
        // Resource links ou texto inline
        if (opts.relatedResources) {
            for (const res of opts.relatedResources) {
                content.push({
                    type: "resource_link",
                    uri: res.uri, name: res.name,
                    description: res.description, mimeType: "text/markdown",
                });
            }
        }
        
        return {
            content,
            structuredContent: this.caps.hasStructuredContent 
                ? opts.structuredData : undefined,
        };
    }
}
```

### 8.3. Analytics e Telemetria (Opt-in)

```typescript
interface MaestroAnalytics {
    sessionDuration: number;
    toolCallCount: Record<string, number>;
    phasesCompleted: number;
    gatePassRate: number;
    averageDeliverableScore: number;
    rollbackCount: number;
    discoveryInteractionCount: number;
    templateUsageRate: number;
}
```

**Privacidade:** Opt-in expl√≠cito, dados anonimizados, armazenamento local em `~/.maestro/analytics/`.

---

## 9. Eixo 6 ‚Äî Ecossistema e Distribui√ß√£o

### 9.1. Publica√ß√£o no MCP Registry

```json
{
    "name": "@maestro/mcp-server",
    "description": "AI-powered software development orchestrator",
    "version": "6.0.0",
    "tools": ["maestro", "executar", "validar", "analisar", "contexto"],
    "transports": ["stdio", "streamable-http"],
    "protocolVersion": "2025-11-25"
}
```

### 9.2. Docker Image Oficial

```dockerfile
FROM node:20-alpine
WORKDIR /app
COPY package*.json ./
RUN npm ci --production
COPY dist/ ./dist/
COPY content/ ./content/
EXPOSE 3000
CMD ["node", "dist/transports/streamable-http.js"]
```

### 9.3. NPX Quick Start

```bash
npx @maestro/mcp-server                          # zero-config
npx @maestro/mcp-server --dir ./meu-projeto       # diret√≥rio espec√≠fico
npx @maestro/mcp-server --transport http --port 3000  # modo HTTP
```

### 9.4. GitHub Actions Integration

```yaml
name: Maestro Gate Validation
on: [pull_request]
jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: maestro/validate-action@v1
        with:
          project-dir: .
          gate-type: "entregavel"
```

---

## 10. Plano de Execu√ß√£o em Fases

### Vis√£o Geral (~9-10 semanas)

```
FASE A ‚Äî Foundation (2 sem)    Breaking changes, cleanup, reestrutura√ß√£o
FASE B ‚Äî Protocol (2 sem)      MCP 2025-11-25, Tasks, Elicitation, Sampling
FASE C ‚Äî Architecture (2 sem)  State machine, persist√™ncia ativa, plugins
FASE D ‚Äî DX & Intel (2 sem)    Onboarding v3, templates, adaptive responses
FASE E ‚Äî Ecosystem (1 sem)     Registry, Docker, NPX, documenta√ß√£o
```

### Fase A ‚Äî Foundation (Semanas 1-2)

| # | Task | Esfor√ßo | Prio |
|---|------|---------|------|
| A.1 | Remover `legacyTools` do router.ts | 1 dia | P0 |
| A.2 | Criar tool `executar.ts` (unifica avancar+salvar+checkpoint) | 2 dias | P0 |
| A.3 | `maestro` subsume `status` (sem a√ß√£o = status) | 1 dia | P0 |
| A.4 | Reescrever `ToolResult` interface (strict, MCP-compliant) | 1 dia | P0 |
| A.5 | Migrar todas as 5 tools para novo ToolResult | 3 dias | P0 |
| A.6 | Remover c√≥digo morto (tools/index.ts, server.ts, etc.) | 1 dia | P1 |
| A.7 | Reestruturar diret√≥rios (nova estrutura limpa) | 1 dia | P1 |
| A.8 | Criar `MIGRATION_GUIDE_v5_to_v6.md` | 0.5 dia | P1 |

### Fase B ‚Äî Protocol Compliance (Semanas 3-4)

| # | Task | Esfor√ßo | Prio |
|---|------|---------|------|
| B.1 | Atualizar SDK e protocol version para 2025-11-25 | 1 dia | P0 |
| B.2 | Implementar Task Manager para opera√ß√µes async | 3 dias | P0 |
| B.3 | Integrar Elicitation nativa no discovery | 2 dias | P1 |
| B.4 | Implementar Sampling with Tools para an√°lise | 2 dias | P1 |
| B.5 | Adicionar Annotations em todos os retornos | 1 dia | P1 |
| B.6 | Migrar index.ts para Streamable HTTP transport | 2 dias | P1 |
| B.7 | Adicionar Icons em tools/resources/prompts | 0.5 dia | P2 |
| B.8 | Input validation ‚Üí Tool Execution Error | 0.5 dia | P2 |

### Fase C ‚Äî Architecture (Semanas 5-6)

| # | Task | Esfor√ßo | Prio |
|---|------|---------|------|
| C.1 | Implementar State Machine formal (flow engine v2) | 3 dias | P0 |
| C.2 | Implementar Persist√™ncia Ativa (servidor grava direto) | 2 dias | P0 |
| C.3 | Client Capabilities Detection v2 (multi-camada) | 1 dia | P0 |
| C.4 | Adaptive Response Builder | 2 dias | P1 |
| C.5 | Plugin Architecture para Analyzers | 2 dias | P2 |
| C.6 | Event System para extensibilidade | 1 dia | P2 |

### Fase D ‚Äî DX & Intelligence (Semanas 7-8)

| # | Task | Esfor√ßo | Prio |
|---|------|---------|------|
| D.1 | Onboarding v3 (2 intera√ß√µes, smart extraction) | 3 dias | P0 |
| D.2 | Project Templates (6 templates pr√©-configurados) | 2 dias | P1 |
| D.3 | Zero-config para projetos simples | 1 dia | P1 |
| D.4 | Modo "Conversa Livre" aprimorado | 2 dias | P2 |
| D.5 | MCP Apps ‚Äî Dashboard de progresso (prototype) | 2 dias | P2 |
| D.6 | Multi-project support | 1 dia | P2 |

### Fase E ‚Äî Ecosystem (Semana 9)

| # | Task | Esfor√ßo | Prio |
|---|------|---------|------|
| E.1 | Publicar no MCP Registry | 1 dia | P1 |
| E.2 | Docker image oficial | 0.5 dia | P1 |
| E.3 | NPX quick start | 0.5 dia | P1 |
| E.4 | Testes de conformidade MCP | 2 dias | P0 |
| E.5 | Documenta√ß√£o completa (API reference, guides) | 2 dias | P1 |

### Depend√™ncias entre Fases

```
A.4 (ToolResult strict) ‚îÄ‚îÄ‚Üí A.5 (migrar tools) ‚îÄ‚îÄ‚Üí B.5 (annotations)
A.1 (remover legacy) ‚îÄ‚îÄ‚Üí A.2 (criar executar)
B.1 (SDK update) ‚îÄ‚îÄ‚Üí B.2 (Tasks) ‚îÄ‚îÄ‚Üí B.4 (Sampling)
B.1 (SDK update) ‚îÄ‚îÄ‚Üí B.3 (Elicitation) ‚îÄ‚îÄ‚Üí D.1 (Onboarding v3)
B.1 (SDK update) ‚îÄ‚îÄ‚Üí B.6 (Streamable HTTP)
C.1 (State Machine) ‚îÄ‚îÄ‚Üí C.2 (Persist√™ncia) ‚îÄ‚îÄ‚Üí D.1 (Onboarding)
C.3 (Caps Detection) ‚îÄ‚îÄ‚Üí C.4 (Adaptive Builder) ‚îÄ‚îÄ‚Üí B.5 (Annotations)
```

---

## 11. Matriz de Risco e Mitiga√ß√£o

| # | Risco | Prob. | Impacto | Mitiga√ß√£o |
|---|-------|-------|---------|-----------|
| R1 | SDK n√£o suporta Tasks em STDIO | M√©dia | Alto | Polling manual; Tasks s√≥ via HTTP inicialmente |
| R2 | Windsurf n√£o atualiza para 2025-11-25 | Alta | M√©dio | Fallbacks para todas as features novas |
| R3 | Breaking changes afastam usu√°rios | M√©dia | Alto | Migration guide; v5.2 mantida em paralelo |
| R4 | State machine formal adiciona complexidade | Baixa | M√©dio | Implementa√ß√£o leve; XState opcional |
| R5 | MCP Apps n√£o suportado em Windsurf | Alta | Baixo | Feature opt-in; funciona sem apps |
| R6 | Sampling rejeitado pelo client | M√©dia | M√©dio | Fallback para checklists inline |
| R7 | Elicitation URL mode bloqueado | M√©dia | Baixo | Usar apenas form mode |
| R8 | Performance com 5 tools fazendo mais | Baixa | M√©dio | Profiling; cache; Tasks para ops pesadas |
| R9 | Reestrutura√ß√£o quebra imports | M√©dia | Alto | Commit at√¥mico; testar build imediatamente |
| R10 | MCP Registry muda API antes de GA | M√©dia | Baixo | Publica√ß√£o √© aditiva; adaptar quando necess√°rio |

### Estrat√©gia de Rollback

- **Fase A:** Branch v5.2 como fallback
- **Fase B:** Features de protocol s√£o aditivas (fallbacks garantem funcionamento)
- **Fase C:** State machine pode coexistir com flow engine atual
- **Fase D:** Features de DX s√£o independentes
- **Fase E:** Publica√ß√£o √© revers√≠vel

---

## 12. M√©tricas de Sucesso

### Quantitativas

| M√©trica | v5.2 (baseline) | v6.0 (alvo) | Melhoria |
|---------|-----------------|-------------|----------|
| Tools p√∫blicas | 8 | 5 | -37% superf√≠cie |
| Tools totais aceitas | 45 | 5 | -89% (zero legacy) |
| Protocol version | 2025-03-26 | 2025-11-25 | +2 vers√µes |
| Content blocks/resposta | 1-2 | 3-5 | +150% granularidade |
| Intera√ß√µes at√© 1¬∫ c√≥digo | 5-10 | 2 | -70% fric√ß√£o |
| Cobertura de testes | ~0% | 90%+ | Novo baseline |
| M√≥dulos √≥rf√£os | 7 | 0 | -100% |
| C√≥digo morto (linhas) | ~1500 | 0 | -100% |
| Features MCP suportadas | 6/16 | 14/16 | +133% compliance |
| Opera√ß√µes async (Tasks) | 0 | 3+ | Novo capability |

### Qualitativas

| Aspecto | v5.2 | v6.0 |
|---------|------|------|
| Adapta√ß√£o por IDE | HTTP only | STDIO + HTTP (4+ IDEs) |
| An√°lise de c√≥digo | Inline (polui contexto) | Sampling dedicada |
| Discovery | Texto livre (erros) | Elicitation nativa (tipado) |
| Persist√™ncia | Depende da IA salvar | Servidor grava direto |
| Distribui√ß√£o | Manual (git clone) | NPX + Registry + Docker |
| Extensibilidade | Hardcoded | Plugin system + Events |
| Visualiza√ß√£o | Texto apenas | MCP Apps (HTML interativo) |

---

## 13. Vis√£o de Longo Prazo (v7+)

### v7.0 ‚Äî Multi-Agent Orchestration

- **Agent-to-Agent:** Maestro delega sub-tarefas para outros MCP servers
- **Maestro como Hub:** Orquestra m√∫ltiplos agents (code, test, deploy)
- **Shared Context:** Contexto compartilhado via MCP Resources

### v8.0 ‚Äî AI-Native Development Platform

- **Code Generation:** Maestro gera c√≥digo diretamente
- **Continuous Validation:** An√°lise em tempo real
- **Learning System:** Aprende padr√µes do desenvolvedor
- **Team Collaboration:** M√∫ltiplos devs, roles diferentes

### Tend√™ncias a Monitorar

| Tend√™ncia | Impacto | Timeline |
|-----------|---------|----------|
| MCP Roots universal | Elimina `diretorio` como par√¢metro | 2026 H1 |
| MCP Tasks est√°vel | Todas as opera√ß√µes async | 2026 H1 |
| MCP Apps em Windsurf | Dashboards visuais para todos | 2026 H2 |
| Multi-agent protocols | Maestro como orquestrador de agents | 2026-2027 |
| Elicitation universal | Discovery perfeito em todas as IDEs | 2026 H1 |
| Server Identity (.well-known) | Auto-discovery do Maestro | 2026 H2 |
| MCP Extensions oficiais | Maestro como extension de "dev orchestration" | 2027 |

---

## Ap√™ndice A ‚Äî Checklist de Valida√ß√£o v6.0

### Funcional
- [ ] 5 tools p√∫blicas funcionando (maestro, executar, validar, analisar, contexto)
- [ ] Zero tools legadas aceitas (retorna erro com migration guide)
- [ ] Protocol version 2025-11-25 no handshake
- [ ] Tasks funcionando para an√°lises longas
- [ ] Elicitation form mode no discovery (quando suportado)
- [ ] Sampling with Tools para an√°lise (quando suportado)
- [ ] Annotations em todos os retornos
- [ ] structuredContent em todas as tools
- [ ] outputSchema definido em todas as tools
- [ ] resource_links nos retornos que referenciam skills
- [ ] Icons em tools, resources e prompts
- [ ] Streamable HTTP transport funcional
- [ ] Persist√™ncia ativa (servidor grava direto)
- [ ] State machine formal para fluxos

### Qualidade
- [ ] `npm run build` compila sem erros nem warnings
- [ ] `npm test` passa 100% com cobertura ‚â•90%
- [ ] Zero m√≥dulos √≥rf√£os
- [ ] Zero c√≥digo morto
- [ ] ToolResult strict (sem index signature)
- [ ] Testes de conformidade MCP passam

### Compatibilidade
- [ ] Funciona em Windsurf (STDIO) com fallbacks
- [ ] Funciona em Cursor (STDIO) com Elicitation
- [ ] Funciona em VS Code (STDIO) com features completas
- [ ] Funciona em Claude Code (STDIO) com fallbacks
- [ ] Funciona via Streamable HTTP (web clients)

### Documenta√ß√£o
- [ ] MIGRATION_GUIDE_v5_to_v6.md publicado
- [ ] API reference atualizado
- [ ] README.md atualizado com novas instru√ß√µes
- [ ] CHANGELOG.md com todas as breaking changes
- [ ] server.json para MCP Registry

---

## Ap√™ndice B ‚Äî Gloss√°rio

| Termo | Defini√ß√£o |
|-------|-----------|
| **MCP Tasks** | Primitiva do protocol para opera√ß√µes ass√≠ncronas com polling (SEP-1686) |
| **Elicitation** | Mecanismo para servidor solicitar dados do usu√°rio via formul√°rio tipado |
| **Sampling** | Mecanismo para servidor solicitar chamada LLM ao client |
| **Annotations** | Metadados em content blocks indicando audi√™ncia e prioridade |
| **structuredContent** | Retorno JSON tipado em tool results (al√©m do texto) |
| **outputSchema** | Schema JSON que define a estrutura esperada do retorno de uma tool |
| **resource_link** | Refer√™ncia a um Resource MCP retornada em tool results |
| **MCP Apps** | Extension oficial para retornar HTML interativo no chat |
| **Streamable HTTP** | Transport MCP com suporte a SSE, sessions e resumability |
| **Icons** | Metadados visuais para tools, resources e prompts (SEP-973) |
| **Strangler Fig** | Padr√£o de migra√ß√£o gradual de arquitetura legada |

---

> **Pr√≥ximo passo:** Ap√≥s revis√£o deste documento, iniciar implementa√ß√£o da Fase A (Foundation) com a conclus√£o da v5.2 como pr√©-requisito.
